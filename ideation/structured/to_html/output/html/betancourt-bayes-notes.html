<!DOCTYPE html>

<html lang="en">

        <head>
                <!-- Page information -->
                <meta charset="UTF-8" />
                <meta name="node_id" content="betancourt-bayes-notes">
                <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                <link rel="shortcut icon" href="/gaita/ideation/structured/html/favicon.ico" />

                <!-- Set title -->
                <title>Obsidian-Html/Notes</title>

                <!-- Includes -->
                
<script src="/gaita/ideation/structured/html/obs.html/static/obsidian_core.js"></script>
<script src="/gaita/ideation/structured/html/obs.html/static/encoding.js"></script>
<link rel="stylesheet" href="/gaita/ideation/structured/html/obs.html/static/master.css" />
<script src="/gaita/ideation/structured/html/obs.html/static/mermaid.9.0.1.min.js"></script>
<script>
  MathJax = {
    loader: {
      load: [
        '[tex]/action',
        'output/chtml',
        '[tex]/centernot'
      ]
    },
    tex: {
      inlineMath: [ ["\\(","\\)"] ],
      displayMath: [ ["\\[","\\]"] ],
      processEscapes: true,
      processEnvironments: true,
      packages: {'[+]': ['centernot']}
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<script src="/gaita/ideation/structured/html/obs.html/static/flexsearch.bundle.js"></script>
<script src="/gaita/ideation/structured/html/obs.html/static/pako.js"></script>
<script src="/gaita/ideation/structured/html/obs.html/static/search.js"></script>
<script src="/gaita/ideation/structured/html/obs.html/static/dirtree.js"></script>


                <!-- Onload tweaks -->
                <script>
                        const CURRENT_NODE = 'betancourt-bayes-notes';
                        const HTML_URL_PREFIX = '/gaita/ideation/structured/html';
                        const PAGE_DEPTH = 0;
                </script>
        </head>

<body class="theme-obs-light">
        <div id="antiflash" style="display: none;"></div>
        <script>
                document.getElementById('antiflash').style.display = 'block';
        </script>
        <div id="search-master-div">
    <div id="search-slab" king_ramses="return the slaaab">
            <div id="search-controls">
                    <input id="search_string" placeholder="Type to search notes" type="text" />
                    <div class="tooltip" style="display: none;">
                        <input type="checkbox" id="hard_search" name="hard" />
                        <span class="tooltiptext">Hard search (require exact match)</span>
                    </div>
                    <div id="search-results-box">
                        <div id="search-results"></div>
                    </div>
                    <div id="search-instructions">
                        <div class="prompt-instruction">
                                <b>esc</b> to dismiss
                        </div>
                    </div>
            </div>
    </div>
</div>

<script>
    document.getElementById("search-master-div").addEventListener('click', e => {
            if(e.target !== e.currentTarget){
                    return
            }
            toggle_id('search-master-div');
    })
    document.getElementById("search_string").addEventListener("input", function(event) {
            setTimeout( () =>run_search('search_string', 'hard_search'), 100 );
    }); 
    document.getElementById("hard_search").addEventListener("click", function(event) {
            setTimeout( () =>run_search('search_string', 'hard_search'), 100 );
    });

    window.addEventListener('keydown', e => {
        if((e.key=='Escape'||e.key=='Esc'||e.keyCode==27)){
            toggle_id('search-master-div');
            return false;
        } 
    }, true);

    function click_list_link(element){
        element.parentElement.getElementsByTagName('a')[0].click()
    }
</script>

        <div id="page_holder" class="flex_col">
                <div id="header" class="header">
    <div id="header_flex" class="flex_row">
            <a href="/gaita/ideation/structured/html/index.html" id="homelink" title="Clear screen and go to homepage">Obsidian-Html/Notes</a>
            <div id="menu_toggle_button" class="navbar-button requires_js" onclick="toggle_menu()">
                    â‰¡
            </div>
            <div id="navbar" class="navbar requires_js">
                    
                    <div class="icon-tray">
                            <div id="theme-button" class="theme-button requires_js" title="Change theme" onclick="toggle_theme_popup(this)">
    T
</div>
<script>
    function toggle_theme_popup(el){
        // make theme button show that it's active by adding the .active class
        toggle(el);

        // show the theme selector
        toggle_id('theme-popup')

        let h2 = document.getElementById('header2')
        if (h2){
            let pu = document.getElementById('header2').getElementsByClassName('popup')[0];
            toggle(pu);
        }
    }

    function disable_theme_popup(){
        disable_id('theme-button');

        // show the theme selector
        disable_id('theme-popup')

        let h2 = document.getElementById('header2')
        if (h2){
            let pu = document.getElementById('header2').getElementsByClassName('popup')[0];
            disable(pu);
        }
    }
</script>
                                    <div onclick="openSearch()" class="theme-button requires_js">
                <img src = "/gaita/ideation/structured/html/obs.html/static/search.svg" alt="Search notes" title="Search notes" style="margin: 4px;"/>
        </div>
        <script>
                function openSearch(){
                        // toggle search popup and continue with extra code if it is enabled this time
                        if (toggle_id('search-master-div')){
                                // clear input and put focus on it so that we can start typing immediately
                                let ss = document.getElementById('search_string');
                                ss.value = '';
                                ss.focus()
                                ss.select()
                        }
                }
        </script>
                                    <div class="graph_header_div requires_js">
            <a id="graph_link" class="system-link" href="/gaita/ideation/structured/html/obs.html/graph/index.html?node=betancourt-bayes-notes" title="Open fullpage Graph">
                    <img class="graph_header_div_svg" src = "/gaita/ideation/structured/html/obs.html/static/graph.svg" alt="Open fullpage Graph" style="margin: 2px; width: 17px;"/>
            </a>
        </div>
                                    <div >
            <a id="dirtree_link" class="system-link" href="/gaita/ideation/structured/html/obs.html/dir_index.html" title="View directory tree">
                    <img src = "/gaita/ideation/structured/html/obs.html/static/dirtree.svg" style="width: 12px; padding: 4px;" alt="Directory tree link"/>
            </a>
        </div>
                            <div>
    <a href="/gaita/ideation/structured/html/obs.html/tags/index.html" title="Open tag view">
            <img src = "/gaita/ideation/structured/html/obs.html/static/hashtag.svg" alt="RSS Feed link" style="width: 24px; margin-left: -2px; margin-top: -2px;"/>
    </a>
</div>
                            
                    </div>
                    <div style="display: flex; flex-direction:column">
                        <div id="left_pane_toggle_nav" class="left_pane_toggle_nav">Toggle Directory Tree Pane</div>
                        <div id="right_pane_toggle_nav" class="right_pane_toggle_nav">Toggle Table of Contents Pane</div>
                    </div>
            </div>
    </div>
    <div class="popup" id="theme-popup">
    <label for="cars">Theme </label>

    <select name="theme" id="theme" onchange="set_theme(this.value)">
      <option value="light">light</option>
      <option value="obs-light" selected="selected">obsidian-light</option>
      <option value="obs-dark">obsidian-dark</option>
    </select> 
</div>
</div>
                <div class="flex_row">
                        <div id="left_pane" class="left_pane active">
    <div id="left_pane_fold_header" class="left_pane_fold_header fold_header">x</div>
    <div id="left_pane_content" class="left_pane_content">
            <div class="dirtree"><button id="folder-1" class="dir-button" onclick="toggle_dir(this.id)">figures</button>
<div id="folder-container-1" class="dir-container requires_js " path="/gaita/ideation/structured/html/figures">
	<ul class="dir-list">
		<li><a class="" href="/gaita/ideation/structured/html/figures/plot-value-function-1.png"  class="external-link">plot-value-function-1</a></li>
		<li><a class="" href="/gaita/ideation/structured/html/figures/run-simulation-1.png"  class="external-link">run-simulation-1</a></li>
		<li><a class="" href="/gaita/ideation/structured/html/figures/unnamed-chunk-2-1.png"  class="external-link">unnamed-chunk-2-1</a></li>
		<li><a class="" href="/gaita/ideation/structured/html/figures/unnamed-chunk-3-1.png"  class="external-link">unnamed-chunk-3-1</a></li>
		<li><a class="" href="/gaita/ideation/structured/html/figures/unnamed-chunk-8-1.png"  class="external-link">unnamed-chunk-8-1</a></li>
		<li><a class="" href="/gaita/ideation/structured/html/figures/unnamed-chunk-8-2.png"  class="external-link">unnamed-chunk-8-2</a></li>
	</ul>
</div>
<ul class="dir-list">
	<li><a class="" href="/gaita/ideation/structured/html/bayes-play.html"  >bayes-play</a></li>
	<li><a class="" href="/gaita/ideation/structured/html/betancourt-bayes-notes.html"  >betancourt-bayes-notes</a></li>
	<li><a class="" href="/gaita/ideation/structured/html/experiment-brainstorming.html"  >experiment-brainstorming</a></li>
	<li><a class="" href="/gaita/ideation/structured/html/experiments.html"  >experiments</a></li>
	<li><a class="" href="/gaita/ideation/structured/html/hierarchical-prospect-theory.html"  >hierarchical-prospect-theory</a></li>
	<li><a class="" href="/gaita/ideation/structured/html/index.html"  >index</a></li>
	<li><a class="" href="/gaita/ideation/structured/html/modeling.html"  >modeling</a></li>
	<li><a class="" href="/gaita/ideation/structured/html/prospect-theory-modeling-tests.html"  >prospect-theory-modeling-tests</a></li>
	<li><a class="" href="/gaita/ideation/structured/html/random-thoughts.html"  >random-thoughts</a></li>
	<li><a class="" href="/gaita/ideation/structured/html/wave-1-experiments.html"  >wave-1-experiments</a></li>
</ul>
</div>
    </div>
</div>
                        <div class="container">
                                <div class="content"><h1 id="hamiltonian-monte-carlo">Hamiltonian Monte Carlo</h1>
<p>This is a space for taking notes on a two-part lecture on Bayes and Stan (<a href="https://www.youtube.com/watch?v=pHsuIaPbNbY" class="external-link">part 1</a>, <a href="https://www.youtube.com/watch?v=xWQpEAyI5s8" class="external-link">part 2</a>)   </p>
<p>Starting by scoping out a 2d space between sample size and model complexity. Saying that as sample size gets bigger, it's harder to fit more complex models. He aspires to specify complex, scientifically meaningful models and fit them to big data.   </p>
<p>A solution is MCMC. Bayesian inference is nice because everything you need for inference is in the posterior distribution.   </p>
<p>To answer statistical questions about parameters, one can either use optimizations or expectations:   </p>
<div class="arithmatex">\[
\begin{align*}
f(\hat{\theta}), \hat{\theta} = \text{argmax}\pi(\theta)\\
\mathbb{E}[f(\theta)] = \int d \theta \pi(\theta) f(\theta)
\end{align*}
\]</div>
<p>He's arguing that expectations are the only things that make sense in high dimensions. He goes into some math as to why, but it's a bit beyond me.   </p>
<p>A challenge is that computing integrals in high dimensional systems is computationally hard. Constructing a posterior is straight forward. So MCMC is essentially just a way of computing an integral in high dimensions.   </p>
<h2 id="stages-of-mcmc">Stages of MCMC</h2>
<ul>
<li>Warmup   <ul>
<li>The algorithm runs for a bit until parameter estimates generally settle down over iterations.   </li>
<li>Goes into a bunch of math. You essentially need to reach an equilibrium convergence.   </li>
<li>You run into trouble if a parameter has a multi modal distribution   <ul>
<li>Which is why you need to run multiple chains   </li>
<li>MCMC not well equipped to handle multi modality   </li>
</ul>
</li>
</ul>
</li>
<li>Sampling   <ul>
<li>Typically a hands-off process, meaning the manual interventions mostly occur in warmup   </li>
<li>Stressing the importance of inspecting chains visually to look for odd behavior   </li>
</ul>
</li>
<li>Analysis   <ul>
<li>Under mild conditions, Monte Carlo expectations are distributed around the true value   <ul>
<li><span class="arithmatex">\(\hat{f} \sim \mathcal{N}(\mathbb{E}[f], \text{MCSE}^2)\)</span>   </li>
<li><span class="arithmatex">\(\text{MCSE}^2 = \text{Var}(f) / \text{ESS}\)</span>, ESS = effective sample size    </li>
<li>Effective sample size is roughly the number of independent samples in the chain, see below   </li>
</ul>
</li>
</ul>
</li>
</ul>
<p>$$
\text{ESS} = \frac{N}{1 + 2 \Sigma^N_{n=1}\rho_n}
$$ <br />
<span class="arithmatex">\(\rho\)</span> is a measure of autocorrelation. <span class="arithmatex">\(n\)</span> is number of lag across iterations. You're essentially summing up autocorrelations across many different lags. ESS gets small as autocorrelation gets big (autocorrelation is bad).   </p>
<h3 id="inspecting-mcmc-estimates">Inspecting MCMC estimates</h3>
<p>In the stan output, you get some summary of parameters having to do with the MCMC chain---look at these to assess whether there was something weird with the chain.    </p>
<p>Talks a bit about model validation and some of the difficulty around generating predictions. I guess predictions are difficult because you only have one dataset, so you can't validate predictions against data that the model hasn't seen (?).    </p>
<h3 id="motivating-hamilitonian-mcmc">Motivating Hamilitonian MCMC</h3>
<p>He says this part is math heavy, but there's good reason that this HMC is good for high dimensions.   </p>
<p>Yea this is over my head and probably not that important. He's just talking about algorithms trying to efficiently explore high dimensional parameter space.   </p>
<h1 id="implementation">Implementation</h1>
<p>Essentially what Stan is doing is constructing a high dimensional probability density.   </p>
<h2 id="program-blocks-to-define-stan-model">Program blocks to define Stan model</h2>
<ul>
<li>data   </li>
<li>transformed data   </li>
<li>parameters (required)   </li>
<li>transformed parameters   </li>
<li>model (required)   </li>
<li>generated quantities    </li>
</ul>
<h3 id="data">Data</h3>
<p>Read in stuff externally.    </p>
<div class="lang-general">

<div class="codehilite"><pre><span></span><code><span class="k">data</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">looks</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">local</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="o">[</span><span class="n">N</span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">array</span><span class="w"></span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


</div>

<h3 id="transformed-data">Transformed data</h3>
<p>Where data gets preprocessed.   </p>
<div class="lang-general">

<div class="codehilite"><pre><span></span><code><span class="n">transformed</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">y</span><span class="o">[</span><span class="n">N</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">y</span><span class="o">[</span><span class="n">n</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="o">[</span><span class="n">n</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


</div>

<h3 id="parameters">Parameters</h3>
<div class="lang-general">

<div class="codehilite"><pre><span></span><code><span class="kn">parameters</span> <span class="p">{</span>
    <span class="kt">real</span><span class="o">&lt;</span><span class="k">lower</span><span class="p">=</span><span class="mf">0</span><span class="o">&gt;</span> <span class="n">lambda1</span><span class="p">;</span>
    <span class="kt">real</span><span class="o">&lt;</span><span class="k">lower</span><span class="p">=</span><span class="mf">0</span><span class="o">&gt;</span> <span class="n">lambda2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>


</div>

<h3 id="transformed-parameters">Transformed parameters</h3>
<p>Only parameters in parameter block get sampled by MCMC   </p>
<div class="lang-general">

<div class="codehilite"><pre><span></span><code><span class="n">transformed</span> <span class="n">parameters</span> <span class="p">{</span>
    <span class="n">real</span><span class="o">&lt;</span><span class="n">lower</span><span class="o">=</span><span class="m">0</span><span class="o">&gt;</span> <span class="n">lambda</span><span class="p">;</span>
    <span class="n">lambda</span> <span class="o">&lt;-</span> <span class="n">lambda1</span> <span class="o">+</span> <span class="n">lambda2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>


</div>

<p>The four blocks above define the scope of variables from which the model is built.    </p>
<h3 id="model">Model</h3>
<p>Where the posterior is defined.   </p>
<div class="lang-general">

<div class="codehilite"><pre><span></span><code><span class="kn">model</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">y</span> <span class="n">is</span> <span class="n">distributed</span> <span class="n">as</span> <span class="n">a</span> <span class="n">poisson</span> <span class="n">with</span> <span class="n">parameter</span> <span class="n">lambda</span>
    <span class="n">y</span> <span class="o">~</span> <span class="n">poisson</span><span class="p">(</span><span class="n">lambda</span><span class="p">);</span>
    <span class="o">//</span> <span class="n">weakly</span> <span class="n">informative</span> <span class="n">priors</span>
    <span class="o">//</span> <span class="n">essentially</span> <span class="n">defining</span> <span class="n">a</span> <span class="n">range</span> <span class="kr">for</span> <span class="n">sampling</span>
    <span class="n">lambda1</span> <span class="o">~</span> <span class="n">cauchy</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">2.5</span><span class="p">);</span>
    <span class="n">lambda2</span> <span class="o">~</span> <span class="n">cauchy</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">2.5</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>


</div>

<h3 id="generated-quantities">Generated quantities</h3>
<p>Allows for post processing (eg posterior predictive checks). Can get random variables to generate pseudo data.   </p>
<div class="lang-general">

<div class="codehilite"><pre><span></span><code><span class="n">generated</span> <span class="n">quantities</span> <span class="p">{</span>
    <span class="n">int</span> <span class="n">x_predict</span><span class="p">;</span>
    <span class="n">x_predict</span> <span class="o">&lt;-</span> <span class="nf">poisson_rng</span><span class="p">(</span><span class="n">lambda</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>


</div>

<p>The order of the blocks is important.   </p>
<p><img alt="matrix" src="matrix.jpg" />   </p>
<h2 id="data-types">Data types</h2>
<ul>
<li>int   </li>
<li>real   </li>
</ul>
<p>Can establish upper and lower bounds.    </p>
<p>Stan transforms all variables to unbounded before sampling (via inverse logit).    </p>
<p>Vectors: <code>real a[10]</code>   <br />
A few others I'm not getting into. Some special data types for special parameter sets.    </p>
<h3 id="usual-control-statements">Usual control statements</h3>
<p><code>if/then/else</code>   </p>
<p><code>for (i in 1:I)</code>   <br />
<code>while (i &lt; I)</code>   </p>
<h3 id="model-sampling">Model sampling</h3>
<p>Statements can be vectorized   </p>
<p>Instead of defining a distribution for each element, define across entire vector at once.   </p>
<p><code>y ~ normal(mu, sigma)</code>   </p>
<p><code>mu</code> and <code>sigma</code> can be scalars or vectors.    </p>
<h2 id="example">Example</h2>
<p>Does some crazy stuff to fit a 2d trend with a moderator.</p></div>
<div class="note-footer">
<div class="backlinks">
<h2>Backlinks</h2>
<ul>
	<li><a class="backlink" href="/gaita/ideation/structured/html/modeling.html">modeling</a></li>
</ul>
</div>

<div class="tags">

</div>

</div>
<div class="graph requires_js ">
    <div id="A226554503506869771672008522576254122426{level}" class="graph_div"></div>
    
    <div class="graph-button-row" style="display:flex;">
        <button class="graph_button graph_show_button" id="B226554503506869771672008522576254122426{level}" level="{level}" note_temp_id="226554503506869771672008522576254122426" onclick="window.ObsHtmlGraph.run(this, '226554503506869771672008522576254122426', 'betancourt-bayes-notes');">
            Show Graph
        </button>
        <button class="graph_button graph_type_button" id="C226554503506869771672008522576254122426{level}" style="flex:1" onclick="window.ObsHtmlGraph.switch_graph_type(this);">
            2D
        </button>
    </div>
</div>

<script type="module">
    if (window.ObsHtmlGraph == undefined){
        import('/gaita/ideation/structured/html/obs.html/static/graph.js').then((Module) => {
            window.ObsHtmlGraph = Module;
            window.ObsHtmlGraph.arm_page(document.getElementById('page_holder'))
        })
    }
</script>




                                <!-- end content -->
                        </div>
                        <div class="container_filler">
                        </div>
                        <div id="right_pane" class="right_pane active">
    <div id="right_pane_fold_header" class="right_pane_fold_header fold_header">x</div>
    <div id="right_pane_content" class="right_pane_content">
            
    </div>
</div>
                </div>
        </div>

        <script>
                function handle_toggle_side_bar(e){
                        let header;
                        let pane; 
                        let target = e.target

                        // switch out the navbar button click for a header click
                        if (target.id == 'left_pane_toggle_nav'){
                                target = document.getElementById('left_pane_fold_header')
                        }
                        else if (target.id == 'right_pane_toggle_nav'){
                                target = document.getElementById('right_pane_fold_header')
                        }

                        // get header and pane
                        if (target.classList.contains('fold_header')) {
                                header = target;
                                pane = target.parentElement;
                        }
                        else {
                                pane = target;
                                header = target.getElementsByClassName('fold_header')[0];
                        }
                        toggle_side_bar(pane, header, true)
                        e.stopPropagation();
                }
                function handle_toggle_side_bar_button(e){
                        document.getElementById('menu_toggle_button').click()
                        handle_toggle_side_bar(e);
                }

                function toggle_side_bar(pane, header, save) {
                        let active = (pane.classList.contains('active'))
                        if (active){
                                disable_side_bar(pane, header, save);
                        }
                        else {
                                enable_side_bar(pane, header, save);
                        }
                }
                function enable_side_bar(pane, header, save){
                        pane.classList.add('active');
                        pane.removeEventListener('click', handle_toggle_side_bar);
                        header.addEventListener('click', handle_toggle_side_bar);
                        set_correct_header_symbol(header);
                        if (save){ save_panel_folding_state(header, true) }
                }
                function disable_side_bar(pane, header, save){
                        pane.classList.remove('active');
                        pane.addEventListener('click', handle_toggle_side_bar);
                        header.removeEventListener('click', handle_toggle_side_bar);
                        set_correct_header_symbol(header);
                        if (save){ save_panel_folding_state(header, false) }
                }
                function set_correct_header_symbol(header){
                        let pane = header.parentElement;
                        let symbol = [['>', '<'],['<', '>']]
                        symbol = symbol[Number(header.classList.contains('right_pane_fold_header'))][Number(pane.classList.contains('active'))];
                        console.log(symbol);
                        header.innerHTML = symbol
                        return header;
                }
                function panel_folding_get_panel_name(header){
                        return ['left', 'right'][Number(header.classList.contains('right_pane_fold_header'))]
                }
                function save_panel_folding_state(header, active){
                        ls_set('pane_folding_state_'+panel_folding_get_panel_name(header), Number(active));
                }
                function load_panel_folding_state(panel_name){
                        val = ls_get('pane_folding_state_'+panel_name)
                        if (!val){ return {'exists': false, 'value': null}}
                        return {'exists': true, 'value': Boolean(Number(val))}
                }
                function set_pane_folding_start(left_header, right_header){
                        // small screen = closed
                        let right_pane_enabled = true;
                        let left_pane_enabled = true;
                        let w = window.visualViewport.width
                        if (w < 1000){
                                left_pane_enabled = false
                        }
                        if (w < 800){
                                right_pane_enabled = false
                        }

                        // get saved values if present
                        let rval = load_panel_folding_state('right')
                        if (rval['exists']){
                                right_pane_enabled = rval['value']
                        }
                        let lval = load_panel_folding_state('left')
                        if (lval['exists']){
                                left_pane_enabled = lval['value']
                        }

                        // default = enabled, so we only need to disable
                        if (!left_pane_enabled){
                                disable_side_bar(document.getElementById('left_pane'), document.getElementById('left_pane_fold_header'))
                        }
                        if (!right_pane_enabled){
                                disable_side_bar(document.getElementById('right_pane'), document.getElementById('right_pane_fold_header'))
                        }
                }

                function init_pane_folding(header){
                        set_correct_header_symbol(header);
                        header.addEventListener('click', handle_toggle_side_bar);
                }
                
                
                set_pane_folding_start()
                init_pane_folding(document.getElementById('left_pane_fold_header'));
                init_pane_folding(document.getElementById('right_pane_fold_header'));

                document.getElementById('left_pane_toggle_nav').addEventListener('click', handle_toggle_side_bar_button);
                document.getElementById('right_pane_toggle_nav').addEventListener('click', handle_toggle_side_bar_button);
        </script>

        <script src="/gaita/ideation/structured/html/obs.html/static/load_dirtree_footer.js" type="text/javascript"></script>

        




</body>
</html>
